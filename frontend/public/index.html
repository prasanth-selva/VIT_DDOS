<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CYNEX – Adaptive Application-Layer DDoS Protection Gateway</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: #050505;
    }

    .mono {
      font-family: 'JetBrains Mono', monospace;
      letter-spacing: 0.05em;
    }

    /* ========== LOGIN PAGE STYLES ========== */
    #login-page {
      background: linear-gradient(135deg, #050505 0%, #0b0b0b 50%, #050505 100%);
      position: relative;
      overflow: hidden;
    }

    /* Animated radial red glow */
    #login-page::before {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(ellipse 1400px at 50% 40%, rgba(239, 68, 68, 0.15) 0%, rgba(239, 68, 68, 0.05) 50%, rgba(239, 68, 68, 0) 80%);
      animation: glow-breathe 6s ease-in-out infinite;
      pointer-events: none;
    }

    @keyframes glow-breathe {
      0%, 100% { opacity: 0.8; }
      50% { opacity: 1; }
    }

    /* Cinematic scan lines */
    #login-page::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        linear-gradient(180deg, transparent 0%, rgba(0, 0, 0, 0.03) 50%, transparent 100%),
        repeating-linear-gradient(0deg, rgba(239, 68, 68, 0.015) 0px, transparent 2px, transparent 4px);
      background-size: 100% 6px, 100% 4px;
      animation: scan-movement 10s linear infinite;
      pointer-events: none;
    }

    @keyframes scan-movement {
      0% { background-position: 0 0, 0 0; }
      100% { background-position: 0 6px, 0 4px; }
    }

    /* Glass morphism card with enhanced depth */
    .login-card {
      background: rgba(11, 11, 11, 0.75);
      backdrop-filter: blur(12px) saturate(120%);
      position: relative;
    }

    /* Red gradient border with mask technique */
    .login-card::before {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: 0.75rem;
      padding: 1.5px;
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.4) 0%, rgba(239, 68, 68, 0.15) 50%, rgba(239, 68, 68, 0.05) 100%);
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      pointer-events: none;
    }

    /* Ambient red glow with layered shadows */
    .login-card-glow {
      box-shadow: 
        0 0 80px rgba(239, 68, 68, 0.3),
        0 20px 60px rgba(0, 0, 0, 0.7),
        inset 0 1px 0 rgba(239, 68, 68, 0.15),
        inset 0 -1px 0 rgba(0, 0, 0, 0.5);
    }

    /* Input fields with enhanced focus */
    .input-field {
      background: rgba(15, 15, 15, 0.6);
      border: 1px solid rgba(239, 68, 68, 0.25);
      transition: all 350ms cubic-bezier(0.33, 0.66, 0.66, 1);
    }

    .input-field:focus {
      outline: none;
      background: rgba(20, 20, 20, 0.7);
      box-shadow: 
        0 0 0 3px rgba(239, 68, 68, 0.3),
        0 0 24px rgba(239, 68, 68, 0.2),
        inset 0 1px 3px rgba(0, 0, 0, 0.5);
      border-color: #ef4444;
    }

    .input-field::placeholder {
      color: rgba(156, 163, 175, 0.4);
      transition: color 250ms ease;
    }

    .input-field:focus::placeholder {
      color: rgba(156, 163, 175, 0.6);
    }

    /* Login button with cinematic effects */
    #login-btn {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      position: relative;
      overflow: hidden;
      transition: all 300ms cubic-bezier(0.33, 0.66, 0.66, 1);
      box-shadow: 
        0 0 30px rgba(239, 68, 68, 0.4),
        0 4px 16px rgba(0, 0, 0, 0.5),
        inset 0 1px 0 rgba(255, 255, 255, 0.15);
    }

    /* Animated shimmer effect */
    #login-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.25), transparent);
      transition: left 600ms cubic-bezier(0.4, 0, 0.2, 1);
    }

    #login-btn:hover::before {
      left: 100%;
    }

    #login-btn:hover {
      background: linear-gradient(135deg, #f87171 0%, #ef4444 100%);
      box-shadow: 
        0 0 50px rgba(239, 68, 68, 0.6),
        0 8px 24px rgba(0, 0, 0, 0.6),
        inset 0 1px 0 rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
    }

    #login-btn:active {
      transform: translateY(0) scale(0.98);
      box-shadow: 
        0 0 20px rgba(239, 68, 68, 0.5),
        0 2px 8px rgba(0, 0, 0, 0.5);
    }

    #login-error {
      animation: fade-in 0.4s ease-out;
      color: #ef4444;
    }

    .status-text {
      color: rgba(239, 68, 68, 0.7);
      font-size: 0.75rem;
      font-family: 'JetBrains Mono', monospace;
      letter-spacing: 0.05em;
    }

    .icon-red {
      color: #ef4444;
    }

    /* ========== DASHBOARD PAGE STYLES ========== */
    #dashboard-page {
      background: linear-gradient(135deg, #050505 0%, #0a0a0a 50%, #050505 100%);
      position: relative;
    }

    #dashboard-page::before {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(ellipse 1800px at 50% 50%, rgba(239, 68, 68, 0.08) 0%, rgba(239, 68, 68, 0) 70%);
      pointer-events: none;
    }

    /* Premium card styling */
    .dashboard-card {
      background: linear-gradient(135deg, rgba(15, 15, 15, 0.9) 0%, rgba(10, 10, 10, 0.8) 100%);
      border: 1px solid rgba(239, 68, 68, 0.15);
      transition: all 300ms cubic-bezier(0.33, 0.66, 0.66, 1);
      position: relative;
      overflow: hidden;
    }

    .dashboard-card::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.05) 0%, transparent 100%);
      opacity: 0;
      transition: opacity 300ms ease;
      pointer-events: none;
    }

    .dashboard-card:hover {
      border-color: rgba(239, 68, 68, 0.3);
      box-shadow: 0 8px 24px rgba(239, 68, 68, 0.15), inset 0 1px 0 rgba(239, 68, 68, 0.1);
      transform: translateY(-2px);
    }

    .dashboard-card:hover::before {
      opacity: 1;
    }

    /* Status indicators with red pulse */
    @keyframes pulse-red {
      0%, 100% { box-shadow: 0 0 12px rgba(239, 68, 68, 0.3); }
      50% { box-shadow: 0 0 24px rgba(239, 68, 68, 0.6); }
    }

    .status-normal {
      animation: pulse-red 2.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    .status-critical {
      animation: pulse-red 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    /* Red grid for charts */
    .chart-grid {
      background-image: 
        linear-gradient(rgba(239, 68, 68, 0.08) 1px, transparent 1px),
        linear-gradient(90deg, rgba(239, 68, 68, 0.08) 1px, transparent 1px);
      background-size: 40px 40px;
    }

    /* Animated metric glow */
    .metric-value {
      font-family: 'JetBrains Mono', monospace;
      letter-spacing: 0.05em;
      font-weight: 600;
      color: #ef4444;
      text-shadow: 0 0 8px rgba(239, 68, 68, 0.3);
    }

    .metric-value.critical {
      text-shadow: 0 0 16px rgba(239, 68, 68, 0.6);
    }

    /* Gauge ring animation */
    .gauge-ring {
      stroke-dasharray: 283;
      stroke-dashoffset: 283;
      transition: stroke-dashoffset 1s ease-out;
    }

    /* Chart line animations */
    @keyframes spike-glow {
      0%, 100% { filter: drop-shadow(0 0 0px rgba(239, 68, 68, 0)); }
      50% { filter: drop-shadow(0 0 8px rgba(239, 68, 68, 0.6)); }
    }

    .chart-spike {
      animation: spike-glow 1.5s ease-in-out infinite;
    }

    /* Sidebar military console feel */
    #sidebar {
      background: linear-gradient(180deg, rgba(8, 8, 8, 0.95) 0%, rgba(5, 5, 5, 0.98) 100%);
      border-right: 1px solid rgba(239, 68, 68, 0.15);
      box-shadow: inset -2px 0 12px rgba(0, 0, 0, 0.3);
    }

    .tab-nav {
      transition: all 250ms cubic-bezier(0.33, 0.66, 0.66, 1);
      border-left: 3px solid transparent;
      position: relative;
    }

    .tab-nav.active {
      background: rgba(239, 68, 68, 0.1);
      border-left-color: #ef4444;
      border-right-color: rgba(239, 68, 68, 0.2);
      box-shadow: inset 0 0 12px rgba(239, 68, 68, 0.08);
    }

    .tab-nav:hover:not(.active) {
      background: rgba(239, 68, 68, 0.05);
      border-left-color: rgba(239, 68, 68, 0.3);
    }

    /* Header styling */
    header {
      background: linear-gradient(90deg, rgba(8, 8, 8, 0.8) 0%, rgba(10, 10, 10, 0.8) 100%);
      border-bottom: 1px solid rgba(239, 68, 68, 0.12);
      backdrop-filter: blur(10px);
    }

    /* Button enhancements */
    button {
      transition: all 250ms cubic-bezier(0.33, 0.66, 0.66, 1);
    }

    button:not(:disabled):active {
      transform: scale(0.96);
    }

    /* Input styling */
    input, select {
      background: rgba(15, 15, 15, 0.6);
      border: 1px solid rgba(239, 68, 68, 0.15);
      transition: all 250ms ease;
    }

    input:focus, select:focus {
      border-color: rgba(239, 68, 68, 0.4);
      box-shadow: 0 0 12px rgba(239, 68, 68, 0.2);
      background: rgba(15, 15, 15, 0.8);
    }

    /* Scrollbar premium styling */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }

    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(15, 15, 15, 0.5);
    }

    ::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, rgba(239, 68, 68, 0.4) 0%, rgba(239, 68, 68, 0.2) 100%);
      border-radius: 4px;
      border: 2px solid rgba(5, 5, 5, 0.5);
    }

    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(180deg, rgba(239, 68, 68, 0.6) 0%, rgba(239, 68, 68, 0.4) 100%);
    }

    @keyframes fade-in {
      0% { opacity: 0; }
      100% { opacity: 1; }
    }

    @keyframes glow-pulse {
      0%, 100% { opacity: 0.8; }
      50% { opacity: 1; }
    }

    .animate-fade-in {
      animation: fade-in 0.6s ease-out forwards;
    }

    .animate-glow-pulse {
      animation: glow-pulse 3s ease-in-out infinite;
    }

    .animate-pulse-red {
      animation: pulse-red 2.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    @keyframes pulse-red {
      0%, 100% { box-shadow: 0 0 12px rgba(239, 68, 68, 0.3); }
      50% { box-shadow: 0 0 24px rgba(239, 68, 68, 0.6); }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full text-gray-100 overflow-auto">
  <div id="login-page" class="h-full flex items-center justify-center relative">
   <div class="w-full max-w-md p-8 relative z-10">
    <!-- Header Section -->
    <div class="text-center mb-12">
     <div class="inline-flex items-center justify-center w-16 h-16 rounded-lg bg-red-soft border border-red-primary/40 mb-6 animate-fade-in" style="animation-delay: 0.1s">
      <svg class="w-8 h-8 text-red-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
      </svg>
     </div>
     <h1 id="login-product-name" class="text-3xl font-semibold text-white mb-2 tracking-tight animate-fade-in" style="animation-delay: 0.2s">CYNEX</h1>
     <p class="text-sm text-gray-400 mono animate-fade-in" style="animation-delay: 0.3s">SECURITY OPERATIONS CENTER</p>
     <div class="h-0.5 w-12 bg-gradient-to-r from-transparent via-red-primary to-transparent mx-auto mt-4 animate-glow-pulse"></div>
    </div>

    <!-- Login Card -->
    <div class="login-card login-card-glow rounded-xl p-8 mb-6 animate-fade-in" style="animation-delay: 0.4s">
     <div class="space-y-6">
      <!-- Email Field -->
      <div>
        <label for="email" class="block text-xs font-semibold text-gray-300 mb-2 uppercase tracking-wider">Email Address</label>
        <div class="relative">
         <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
          <svg class="w-4 h-4 icon-red" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
          </svg>
         </div>
         <input type="email" id="email" placeholder="analyst@company.com" class="input-field w-full pl-11 pr-4 py-3 bg-transparent rounded-lg text-white placeholder-gray-600 mono font-medium" />
        </div>
      </div>

      <!-- Password Field -->
      <div>
        <label for="password" class="block text-xs font-semibold text-gray-300 mb-2 uppercase tracking-wider">Password</label>
        <div class="relative">
         <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
          <svg class="w-4 h-4 icon-red" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
          </svg>
         </div>
         <input type="password" id="password" placeholder="••••••••••••" class="input-field w-full pl-11 pr-4 py-3 bg-transparent rounded-lg text-white placeholder-gray-600 font-medium" />
        </div>
      </div>

      <!-- Login Button -->
      <button id="login-btn" class="w-full py-3 text-white font-semibold rounded-lg transition-all duration-250 flex items-center justify-center gap-2 uppercase text-sm tracking-wide mt-8">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1" />
       </svg>
       SECURE LOGIN
      </button>

      <!-- Error Message -->
      <p id="login-error" class="hidden mt-3 text-xs text-red-primary mono font-medium">> ERROR: Invalid credentials. Please try again.</p>
     </div>

     <!-- Divider -->
     <div class="mt-7 pt-7 border-t border-red-soft">
      <div class="flex items-center justify-center gap-2 status-text">
       <span class="inline-block w-2 h-2 bg-red-primary rounded-full animate-pulse-red"></span>
       <span class="mono font-medium">PROTECTED BY TLS 1.3 ENCRYPTION</span>
      </div>
     </div>
    </div>

    <!-- Footer Status -->
    <div class="text-center animate-fade-in" style="animation-delay: 0.6s">
     <p class="text-xs text-gray-500 mono">v1.0.0 • SOC ACCESS TERMINAL • EST. 2024</p>
    </div>
   </div>
  </div>
  <div id="dashboard-page" class="h-full hidden flex-1">
   <div class="flex h-full">
    <aside id="sidebar" class="w-64 flex flex-col transition-all duration-300">
     <div class="p-5 border-b border-red-soft/30">
      <div class="flex items-center gap-3">
       <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-red-primary/20 to-red-accent/20 border border-red-primary/30 flex items-center justify-center">
        <svg class="w-5 h-5 text-red-primary" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" /></svg>
       </div>
       <div>
        <h2 class="text-sm font-semibold text-white">ADMD</h2>
        <p class="text-xs text-gray-500">v2.4.1</p>
       </div>
      </div>
     </div>
    <nav class="flex-1 p-4 space-y-1"><button class="tab-nav w-full active flex items-center gap-3 px-4 py-3 rounded-lg bg-red-primary/10 text-red-primary border border-red-primary/20 transition-all" data-tab="dashboard">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z" /></svg> Dashboard </button> <button class="tab-nav w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-400 hover:text-white hover:bg-red-primary/5 transition-all" data-tab="traffic">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg> Traffic Monitoring </button> <button class="tab-nav w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-400 hover:text-white hover:bg-red-primary/5 transition-all" data-tab="botanalysis">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg> Bot vs Human </button> <button class="tab-nav w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-400 hover:text-white hover:bg-red-primary/5 transition-all" data-tab="alerts">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" /></svg> Alerts &amp; Logs </button> <button class="tab-nav w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-400 hover:text-white hover:bg-red-primary/5 transition-all" data-tab="gateway">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 7h18M3 12h18M3 17h18" /></svg> Gateway </button> <button class="tab-nav w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-400 hover:text-white hover:bg-red-primary/5 transition-all" data-tab="settings">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg> Settings </button>
     </nav>
     <div class="p-4 border-t border-red-soft/30">
      <div class="flex items-center gap-3 px-3 py-2">
       <div id="user-initials" class="w-8 h-8 rounded-full bg-gradient-to-br from-red-primary to-red-accent flex items-center justify-center text-xs font-semibold text-white">
        SA
       </div>
       <div class="flex-1 min-w-0">
        <p id="user-display-name" class="text-sm font-medium text-white truncate">SOC Analyst</p>
        <p id="user-role" class="text-xs text-gray-500 truncate">Level 2</p>
       </div><button id="logout-btn" class="p-1.5 rounded-lg text-gray-400 hover:text-white hover:bg-red-primary/10 transition-all">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg></button>
      </div>
     </div>
    </aside>
    <main class="flex-1 flex flex-col overflow-hidden">
     <header class="bg-black/20 border-b border-red-soft/30 px-6 py-4">
      <div class="flex items-center justify-between">
       <div class="flex items-center gap-4"><button id="toggle-sidebar" class="p-2 rounded-lg text-gray-400 hover:text-white hover:bg-red-primary/10 transition-all lg:hidden">
         <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg></button>
        <div>
         <h1 id="dashboard-product-name" class="text-xl font-semibold text-white">CYNEX Gateway</h1>
         <p id="dashboard-environment" class="text-sm text-gray-400 mt-0.5">Standby</p>
        </div>
       </div>
       <div class="flex items-center gap-6">
        <div id="system-status" class="flex items-center gap-3 px-4 py-2 rounded-lg bg-red-primary/10 border border-red-primary/30">
         <div class="w-2.5 h-2.5 rounded-full bg-red-primary animate-pulse-red"></div><span class="text-sm font-medium text-red-primary">System Active</span>
        </div>
        <div class="flex items-center gap-2 text-gray-400">
         <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg><span id="clock" class="metric-value text-sm">00:00:00</span>
        </div>
       </div>
      </div>
     </header>
     <div class="flex-1 overflow-auto p-6">
      <div id="dashboard-tab" class="tab-content grid grid-cols-12 gap-5">
       <div class="dashboard-card col-span-8 relative overflow-hidden">
        <div class="flex items-center justify-between mb-4">
         <div class="flex items-center gap-2">
          <svg class="w-5 h-5 text-red-primary" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>
          <h3 class="text-sm font-semibold text-white">Traffic Monitoring</h3>
         </div>
         <div class="flex items-center gap-4 text-xs">
          <div class="flex items-center gap-1.5">
           <div class="w-2 h-2 rounded-full bg-red-primary"></div><span class="text-gray-400">Incoming</span>
          </div>
          <div class="flex items-center gap-1.5">
           <div class="w-2 h-2 rounded-full bg-emerald-400"></div><span class="text-gray-400">Clean</span>
          </div>
          <div class="flex items-center gap-1.5">
           <div class="w-2 h-2 rounded-full bg-red-accent"></div><span class="text-gray-400">Rate Limited</span>
          </div>
         </div>
        </div>
        <div class="h-48 relative chart-grid rounded-lg">
         <svg id="traffic-chart" class="w-full h-full" viewbox="0 0 800 200" preserveaspectratio="none"><defs>
           <lineargradient id="incomingGrad" x1="0%" y1="0%" x2="0%" y2="100%">
            <stop offset="0%" style="stop-color:rgb(239, 68, 68);stop-opacity:0.3" />
            <stop offset="100%" style="stop-color:rgb(239, 68, 68);stop-opacity:0" />
           </lineargradient>
          </defs> <path id="traffic-area" fill="url(#incomingGrad)" d="M0,200 L0,200 L800,200 L800,200 Z" /> <path id="traffic-line" fill="none" stroke="#ef4444" stroke-width="2" d="M0,200 L800,200" /> <path id="clean-line" fill="none" stroke="#34d399" stroke-width="2" stroke-dasharray="4,4" d="M0,200 L800,200" />
         </svg>
         <div class="absolute top-4 left-1/3 px-2 py-1 bg-amber-500/20 border border-amber-500/40 rounded text-xs text-amber-400">
          Traffic Surge
         </div>
         <div class="absolute top-4 right-1/4 px-2 py-1 bg-cyan-500/20 border border-cyan-500/40 rounded text-xs text-cyan-400">
          Mitigation Active
         </div>
        </div>
        <div class="flex items-center justify-between mt-4 pt-4 border-t border-red-soft/30">
         <div class="text-center">
          <p class="metric-value text-2xl font-semibold text-white" id="packets-per-sec">0</p>
          <p class="text-xs text-gray-500">Requests/sec</p>
         </div>
         <div class="text-center">
          <p class="metric-value text-2xl font-semibold text-red-primary" id="bandwidth">0</p>
          <p class="text-xs text-gray-500">Gbps</p>
         </div>
         <div class="text-center">
          <p class="metric-value text-2xl font-semibold text-emerald-400" id="clean-traffic">0%</p>
          <p class="text-xs text-gray-500">Clean Traffic</p>
         </div>
         <div class="text-center">
          <p class="metric-value text-2xl font-semibold text-red-accent" id="blocked-traffic">0%</p>
          <p class="text-xs text-gray-500">Rate Limited</p>
         </div>
        </div>
       </div>
       <div class="dashboard-card col-span-4">
        <div class="flex items-center gap-2 mb-4">
         <svg class="w-5 h-5 text-red-primary" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>
         <h3 class="text-sm font-semibold text-white">Anomaly &amp; Attack Status</h3>
        </div>
        <div class="flex items-center justify-center mb-4">
         <div class="relative">
          <svg class="w-36 h-36 transform -rotate-90"><circle cx="72" cy="72" r="60" fill="none" stroke="#1a1a1a" stroke-width="8" /> <circle id="gauge-ring" cx="72" cy="72" r="60" fill="none" stroke="#ef4444" stroke-width="8" class="gauge-ring" style="stroke-dashoffset: 180;" /></svg>
          <div class="absolute inset-0 flex flex-col items-center justify-center"><span id="anomaly-score" class="metric-value text-3xl font-bold text-red-primary">0</span> <span class="text-xs text-gray-500">Anomaly Score</span>
          </div>
         </div>
        </div>
        <div class="space-y-3">
         <div class="flex items-center justify-between p-3 bg-black/20 rounded-lg"><span class="text-sm text-gray-400">Attack Confidence</span> <span id="attack-confidence" class="metric-value text-sm font-semibold text-red-primary">0%</span></div>
         <div class="flex items-center justify-between p-3 bg-black/20 rounded-lg"><span class="text-sm text-gray-400">Detection State</span> <span id="detection-state" class="text-sm font-semibold text-red-primary">Monitoring</span></div>
        </div>
       </div>
       <div class="dashboard-card col-span-4">
        <div class="flex items-center gap-2 mb-4">
         <svg class="w-5 h-5 text-red-primary" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" /></svg>
         <h3 class="text-sm font-semibold text-white">Protocol Distribution</h3>
        </div>
        <div class="space-y-3">
         <div>
          <div class="flex items-center justify-between mb-1.5"><span class="text-sm text-gray-400">HTTP/1.1</span> <span id="proto-http1-value" class="metric-value text-sm text-red-primary">0%</span></div>
          <div class="h-2 bg-gray-700 rounded-full overflow-hidden">
           <div id="proto-http1-bar" class="h-full bg-gradient-to-r from-red-primary to-red-accent rounded-full" style="width: 0%"></div>
          </div>
         </div>
         <div>
          <div class="flex items-center justify-between mb-1.5"><span class="text-sm text-gray-400">HTTP/2</span> <span id="proto-http2-value" class="metric-value text-sm text-red-primary">0%</span></div>
          <div class="h-2 bg-gray-700 rounded-full overflow-hidden">
           <div id="proto-http2-bar" class="h-full bg-gradient-to-r from-red-soft to-red-primary rounded-full" style="width: 0%"></div>
          </div>
         </div>
         <div>
          <div class="flex items-center justify-between mb-1.5"><span class="text-sm text-gray-400">WebSocket</span> <span id="proto-ws-value" class="metric-value text-sm text-red-primary">0%</span></div>
          <div class="h-2 bg-gray-700 rounded-full overflow-hidden">
           <div id="proto-ws-bar" class="h-full bg-gradient-to-r from-red-accent to-red-primary rounded-full" style="width: 0%"></div>
          </div>
         </div>
        </div>
       </div>
       <div class="dashboard-card col-span-4">
        <div class="flex items-center gap-2 mb-4">
         <svg class="w-5 h-5 text-red-primary" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg>
         <h3 class="text-sm font-semibold text-white">Bot vs Human Analysis</h3>
        </div>
        <div class="flex items-center gap-6">
         <div class="relative">
          <svg class="w-28 h-28" viewbox="0 0 100 100"><circle cx="50" cy="50" r="40" fill="none" stroke="#0f172a" stroke-width="12" /> <circle id="bot-arc-mini" cx="50" cy="50" r="40" fill="none" stroke="#a78bfa" stroke-width="12" stroke-dasharray="0 251.3" stroke-dashoffset="0" transform="rotate(-90 50 50)" /> <circle id="human-arc-mini" cx="50" cy="50" r="40" fill="none" stroke="#22d3ee" stroke-width="12" stroke-dasharray="0 251.3" stroke-dashoffset="0" transform="rotate(-90 50 50)" /></svg>
          <div class="absolute inset-0 flex items-center justify-center"><span id="bot-human-total" class="metric-value text-lg font-bold text-white">0</span></div>
         </div>
         <div class="flex-1 space-y-3">
          <div class="p-2.5 bg-violet-500/10 border border-violet-500/30 rounded-lg">
           <div class="flex items-center justify-between">
            <div class="flex items-center gap-2">
             <svg class="w-4 h-4 text-violet-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg><span class="text-sm text-violet-200">Bot Traffic</span>
            </div><span id="bot-percent-main" class="metric-value text-sm font-semibold text-violet-300">0%</span>
           </div>
           <div class="mt-2 h-1.5 bg-slate-800 rounded-full overflow-hidden">
            <div id="bot-percent-bar-main" class="h-full bg-gradient-to-r from-violet-500 to-violet-300 rounded-full" style="width: 0%"></div>
           </div>
          </div>
          <div class="p-2.5 bg-cyan-500/10 border border-cyan-500/30 rounded-lg">
           <div class="flex items-center justify-between">
            <div class="flex items-center gap-2">
             <svg class="w-4 h-4 text-cyan-300" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg><span class="text-sm text-cyan-200">Human Traffic</span>
            </div><span id="human-percent-main" class="metric-value text-sm font-semibold text-cyan-300">0%</span>
           </div>
           <div class="mt-2 h-1.5 bg-slate-800 rounded-full overflow-hidden">
            <div id="human-percent-bar-main" class="h-full bg-gradient-to-r from-cyan-500 to-cyan-300 rounded-full" style="width: 0%"></div>
           </div>
          </div>
         </div>
        </div>
       </div>
       <div class="dashboard-card col-span-4">
        <div class="flex items-center gap-2 mb-4">
         <svg class="w-5 h-5 text-red-primary" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" /></svg>
         <h3 class="text-sm font-semibold text-white">Mitigation Actions</h3>
        </div>
        <div class="space-y-2 max-h-40 overflow-y-auto pr-1" id="mitigation-actions"></div>
       </div>
       <div class="dashboard-card col-span-6">
        <div class="flex items-center gap-2 mb-4">
         <svg class="w-5 h-5 text-red-primary" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>
         <h3 class="text-sm font-semibold text-white">AI Explainability</h3>
        </div>
        <div class="grid grid-cols-2 gap-4">
         <div>
          <p class="text-xs text-gray-500 mb-3">Feature Importance</p>
          <div class="space-y-2.5" id="feature-importance"></div>
         </div>
         <div class="bg-black/20 rounded-lg p-4">
          <p class="text-xs text-gray-500 mb-2">Current Assessment</p>
          <p id="explainability-text" class="text-sm text-gray-300 leading-relaxed">Awaiting telemetry.</p>
         </div>
        </div>
       </div>
       <div class="dashboard-card col-span-6">
        <div class="flex items-center justify-between mb-4">
         <div class="flex items-center gap-2">
          <svg class="w-5 h-5 text-red-primary" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" /></svg>
          <h3 class="text-sm font-semibold text-white">Alerts &amp; Logs</h3>
         </div><span class="px-2 py-0.5 bg-red-primary/20 text-red-primary text-xs font-medium rounded">Live</span>
        </div>
        <div class="space-y-2 max-h-44 overflow-y-auto pr-1" id="alerts-list"></div>
       </div>
      </div>
      <div id="traffic-tab" class="tab-content hidden grid grid-cols-12 gap-5">
       <div class="dashboard-card col-span-12">
        <div class="flex items-center justify-between mb-6">
         <div class="flex items-center gap-3">
          <svg class="w-6 h-6 text-red-primary" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>
          <h2 class="text-lg font-semibold text-white">Advanced Traffic Analysis</h2>
         </div>
         <div class="flex items-center gap-2"><select class="px-3 py-2 bg-black/30 border border-red-soft/50 rounded-lg text-sm text-white focus:outline-none focus:border-red-primary transition-colors"> <option>Last 24 Hours</option> <option>Last 7 Days</option> <option>Last 30 Days</option> </select></div>
        </div>
        <div class="grid grid-cols-2 gap-5 mb-6">
         <div class="bg-black/20 rounded-lg p-5 border border-red-soft/30">
          <h3 class="text-sm font-semibold text-white mb-4">Requests Per Second (Real-time)</h3>
          <div class="h-48 relative chart-grid rounded-lg mb-4">
           <svg id="pps-chart" class="w-full h-full" viewbox="0 0 600 200" preserveaspectratio="none"><defs>
             <lineargradient id="ppsGrad" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" style="stop-color:rgb(239, 68, 68);stop-opacity:0.3" />
              <stop offset="100%" style="stop-color:rgb(239, 68, 68);stop-opacity:0" />
             </lineargradient>
            </defs> <path id="pps-area" fill="url(#ppsGrad)" d="M0,200 L0,200 L600,200 L600,200 Z" /> <path id="pps-line" fill="none" stroke="#ef4444" stroke-width="2" d="M0,200 L600,200" /></svg>
          </div>
          <div class="flex justify-between text-xs text-gray-500"><span id="pps-peak" class="metric-value">Peak: 0 rps</span> <span id="pps-avg" class="metric-value">Avg: 0 rps</span> <span id="pps-current" class="metric-value">Current: 0 rps</span></div>
         </div>
         <div class="bg-black/20 rounded-lg p-5 border border-red-soft/30">
          <h3 class="text-sm font-semibold text-white mb-4">Bandwidth Usage (Gbps)</h3>
          <div class="h-48 relative chart-grid rounded-lg mb-4">
           <svg id="bw-chart" class="w-full h-full" viewbox="0 0 600 200" preserveaspectratio="none"><defs>
             <lineargradient id="bwGrad" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" style="stop-color:rgb(239, 68, 68);stop-opacity:0.3" />
              <stop offset="100%" style="stop-color:rgb(239, 68, 68);stop-opacity:0" />
             </lineargradient>
            </defs> <path id="bw-area" fill="url(#bwGrad)" d="M0,200 L0,200 L600,200 L600,200 Z" /> <path id="bw-line" fill="none" stroke="#ef4444" stroke-width="2" d="M0,200 L600,200" /></svg>
          </div>
          <div class="flex justify-between text-xs text-gray-500"><span id="bw-peak" class="metric-value">Peak: 0 Gbps</span> <span id="bw-avg" class="metric-value">Avg: 0 Gbps</span> <span id="bw-current" class="metric-value">Current: 0 Gbps</span></div>
         </div>
        </div>
        <div class="grid grid-cols-3 gap-4">
         <div class="bg-black/20 rounded-lg p-4 border border-red-soft/30">
          <h4 class="text-xs text-gray-500 mb-3 uppercase font-semibold">Top Sources</h4>
          <div class="space-y-2">
           <div class="flex items-center justify-between text-sm"><span class="text-red-primary mono">/api/auth</span> <span class="text-white font-semibold">Primary</span></div>
           <div class="flex items-center justify-between text-sm"><span class="text-gray-400 mono">/api/search</span> <span class="text-white font-semibold">Secondary</span></div>
           <div class="flex items-center justify-between text-sm"><span class="text-gray-400 mono">/</span> <span class="text-white font-semibold">Tertiary</span></div>
          </div>
         </div>
         <div class="bg-black/20 rounded-lg p-4 border border-red-soft/30">
          <h4 class="text-xs text-gray-500 mb-3 uppercase font-semibold">Top Destinations</h4>
          <div class="space-y-2">
           <div class="flex items-center justify-between text-sm"><span class="text-red-primary mono">Origin Cluster A</span> <span class="text-white font-semibold">Active</span></div>
           <div class="flex items-center justify-between text-sm"><span class="text-gray-400 mono">Origin Cluster B</span> <span class="text-white font-semibold">Active</span></div>
           <div class="flex items-center justify-between text-sm"><span class="text-gray-400 mono">Origin Cluster C</span> <span class="text-white font-semibold">Standby</span></div>
          </div>
         </div>
         <div class="bg-black/20 rounded-lg p-4 border border-red-soft/30">
          <h4 class="text-xs text-gray-500 mb-3 uppercase font-semibold">Attack Types</h4>
          <div class="space-y-2">
           <div class="flex items-center justify-between text-sm"><span class="text-red-primary">Flood</span> <span class="text-red-accent font-semibold">Observed</span></div>
           <div class="flex items-center justify-between text-sm"><span class="text-red-light">Bot</span> <span class="text-red-accent font-semibold">Observed</span></div>
           <div class="flex items-center justify-between text-sm"><span class="text-emerald-300">Legitimate</span> <span class="text-emerald-400 font-semibold">Normal</span></div>
          </div>
         </div>
        </div>
       </div>
      </div>
      <div id="botanalysis-tab" class="tab-content hidden grid grid-cols-12 gap-5">
       <div class="dashboard-card col-span-12">
        <div class="flex items-center gap-3 mb-6">
         <svg class="w-6 h-6 text-red-primary" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg>
         <h2 class="text-lg font-semibold text-white">Bot vs Human Traffic Analysis</h2>
        </div>
        <div class="grid grid-cols-3 gap-5">
         <div class="col-span-1 bg-slate-900/50 rounded-lg p-6 border border-slate-700/30 flex flex-col items-center">
          <h3 class="text-sm font-semibold text-white mb-6">Overall Distribution</h3>
          <svg class="w-40 h-40 mb-4" viewbox="0 0 100 100"><circle cx="50" cy="50" r="40" fill="none" stroke="#0f172a" stroke-width="12" /> <circle id="bot-arc-large" cx="50" cy="50" r="40" fill="none" stroke="#8b5cf6" stroke-width="12" stroke-dasharray="0 251.3" stroke-dashoffset="0" transform="rotate(-90 50 50)" /> <circle id="human-arc-large" cx="50" cy="50" r="40" fill="none" stroke="#22d3ee" stroke-width="12" stroke-dasharray="0 251.3" stroke-dashoffset="0" transform="rotate(-90 50 50)" /></svg>
          <div class="w-full space-y-2">
           <div class="p-2 bg-violet-500/10 rounded border border-violet-500/20">
            <div class="flex items-center justify-between"><span class="text-xs text-violet-200">Bot Traffic</span> <span id="bot-percent-overall" class="metric-value font-semibold text-violet-300">0%</span></div>
            <div class="mt-2 h-1.5 bg-slate-800 rounded-full overflow-hidden">
             <div id="bot-percent-bar-overall" class="h-full bg-gradient-to-r from-violet-500 to-violet-300 rounded-full" style="width: 0%"></div>
            </div>
           </div>
           <div class="p-2 bg-cyan-500/10 rounded border border-cyan-500/20">
            <div class="flex items-center justify-between"><span class="text-xs text-cyan-200">Human Traffic</span> <span id="human-percent-overall" class="metric-value font-semibold text-cyan-300">0%</span></div>
            <div class="mt-2 h-1.5 bg-slate-800 rounded-full overflow-hidden">
             <div id="human-percent-bar-overall" class="h-full bg-gradient-to-r from-cyan-500 to-cyan-300 rounded-full" style="width: 0%"></div>
            </div>
           </div>
          </div>
         </div>
         <div class="col-span-1 bg-black/20 rounded-lg p-6 border border-red-soft/30">
          <h3 class="text-sm font-semibold text-white mb-4 flex items-center gap-2">
           <svg class="w-5 h-5 text-red-primary" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg> Bot Traffic Details</h3>
          <div class="space-y-3 text-sm">
           <div class="flex justify-between p-2 bg-red-primary/10 rounded"><span class="text-gray-400">Total Requests</span> <span id="bot-total-requests" class="metric-value text-red-primary font-semibold">0</span></div>
           <div class="flex justify-between p-2 bg-red-primary/10 rounded"><span class="text-gray-400">Unique Bots</span> <span id="bot-unique" class="metric-value text-red-primary font-semibold">0</span></div>
           <div class="flex justify-between p-2 bg-red-primary/10 rounded"><span class="text-gray-400">Blocked</span> <span id="bot-blocked-percent" class="metric-value text-red-accent font-semibold">0%</span></div>
           <div class="flex justify-between p-2 bg-red-primary/10 rounded"><span class="text-gray-400">Allowed</span> <span id="bot-allowed-percent" class="metric-value text-emerald-400 font-semibold">0%</span></div>
           <div class="flex justify-between p-2 bg-red-primary/10 rounded"><span class="text-gray-400">Avg Intensity</span> <span id="bot-intensity" class="metric-value text-red-light font-semibold">Low</span></div>
          </div>
         </div>
         <div class="col-span-1 bg-black/20 rounded-lg p-6 border border-red-soft/30">
          <h3 class="text-sm font-semibold text-white mb-4 flex items-center gap-2">
           <svg class="w-5 h-5 text-red-accent" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg> Human Traffic Details</h3>
          <div class="space-y-3 text-sm">
           <div class="flex justify-between p-2 bg-red-accent/10 rounded"><span class="text-gray-400">Total Requests</span> <span id="human-total-requests" class="metric-value text-red-accent font-semibold">0</span></div>
           <div class="flex justify-between p-2 bg-red-accent/10 rounded"><span class="text-gray-400">Unique Users</span> <span id="human-unique" class="metric-value text-red-accent font-semibold">0</span></div>
           <div class="flex justify-between p-2 bg-red-accent/10 rounded"><span class="text-gray-400">Allowed</span> <span id="human-allowed-percent" class="metric-value text-emerald-400 font-semibold">0%</span></div>
           <div class="flex justify-between p-2 bg-red-accent/10 rounded"><span class="text-gray-400">Blocked</span> <span id="human-blocked-percent" class="metric-value text-red-accent font-semibold">0%</span></div>
           <div class="flex justify-between p-2 bg-red-accent/10 rounded"><span class="text-gray-400">Avg Latency</span> <span id="human-latency" class="metric-value text-red-accent font-semibold">0ms</span></div>
          </div>
         </div>
        </div>
        <div class="mt-5 bg-black/20 rounded-lg p-5 border border-red-soft/30">
         <h3 class="text-sm font-semibold text-white mb-4">Bot Classification</h3>
         <div class="grid grid-cols-4 gap-4">
          <div class="text-center p-4 rounded-lg bg-red-primary/10 border border-red-primary/20">
           <p id="bot-malicious" class="metric-value text-2xl font-bold text-red-primary">0</p>
           <p class="text-xs text-gray-500 mt-1">Malicious Bots</p>
          </div>
          <div class="text-center p-4 rounded-lg bg-red-light/10 border border-red-light/20">
           <p id="bot-scrapers" class="metric-value text-2xl font-bold text-red-light">0</p>
           <p class="text-xs text-gray-500 mt-1">Scrapers</p>
          </div>
          <div class="text-center p-4 rounded-lg bg-red-accent/10 border border-red-accent/20">
           <p id="bot-crawlers" class="metric-value text-2xl font-bold text-red-accent">0</p>
           <p class="text-xs text-gray-500 mt-1">Search Crawlers</p>
          </div>
          <div class="text-center p-4 rounded-lg bg-emerald-500/10 border border-emerald-500/20">
           <p id="bot-legit" class="metric-value text-2xl font-bold text-emerald-400">0</p>
           <p class="text-xs text-gray-500 mt-1">Legitimate APIs</p>
          </div>
         </div>
        </div>
       </div>
      </div>
      <div id="alerts-tab" class="tab-content hidden grid grid-cols-12 gap-5">
       <div class="dashboard-card col-span-12">
        <div class="flex items-center justify-between mb-6">
         <div class="flex items-center gap-3">
          <svg class="w-6 h-6 text-red-primary" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" /></svg>
          <h2 class="text-lg font-semibold text-white">Comprehensive Alert Logs</h2>
         </div>
         <div class="flex items-center gap-3">
          <select class="px-3 py-2 bg-black/30 border border-red-soft/50 rounded-lg text-sm text-white focus:outline-none focus:border-red-primary transition-colors">
           <option>All Severity</option>
           <option>Critical</option>
           <option>Warning</option>
           <option>Info</option>
          </select>
          <button id="manual-telegram-alert" class="px-4 py-2 bg-violet-500/30 hover:bg-violet-500/50 text-white rounded-lg text-sm font-medium transition-colors">
           Send Telegram Alert
          </button>
          <button id="export-alerts" class="px-4 py-2 bg-amber-500/80 hover:bg-amber-500 text-white rounded-lg text-sm font-medium transition-colors">Export</button>
         </div>
        </div>
        <p id="manual-telegram-status" class="text-xs text-gray-500 mt-2"></p>
        <div class="grid grid-cols-4 gap-4 mb-6">
         <div class="bg-black/20 rounded-lg p-4 border border-red-primary/30">
          <p class="text-xs text-gray-500 uppercase font-semibold mb-1">Critical</p>
          <p class="metric-value text-3xl font-bold text-red-primary" id="critical-count">0</p>
         </div>
         <div class="bg-black/20 rounded-lg p-4 border border-red-light/30">
          <p class="text-xs text-gray-500 uppercase font-semibold mb-1">Warning</p>
          <p class="metric-value text-3xl font-bold text-red-light" id="warning-count">0</p>
         </div>
         <div class="bg-black/20 rounded-lg p-4 border border-red-accent/30">
          <p class="text-xs text-gray-500 uppercase font-semibold mb-1">Info</p>
          <p class="metric-value text-3xl font-bold text-red-accent" id="info-count">0</p>
         </div>
         <div class="bg-black/20 rounded-lg p-4 border border-emerald-500/30">
          <p class="text-xs text-gray-500 uppercase font-semibold mb-1">Resolved</p>
          <p class="metric-value text-3xl font-bold text-emerald-400">0</p>
         </div>
        </div>
        <div class="bg-black/20 rounded-lg p-5 border border-red-soft/30 max-h-96 overflow-y-auto space-y-2" id="alerts-timeline"></div>
       </div>
      </div>
        <div id="gateway-tab" class="tab-content hidden grid grid-cols-12 gap-5">
         <div class="dashboard-card col-span-5">
          <h3 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
           <svg class="w-6 h-6 text-red-primary" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 3l9 4.5v9L12 21l-9-4.5v-9L12 3z" /></svg> Register Target</h3>
          <form id="gateway-target-form" class="space-y-4">
           <div>
            <label class="block text-sm font-medium text-gray-300 mb-2" for="target-id">Target ID</label>
            <input id="target-id" required placeholder="app1" class="w-full px-4 py-2 bg-black/30 border border-red-soft/50 rounded-lg text-white focus:outline-none focus:border-red-primary transition-colors">
            <p class="text-xs text-gray-500 mt-1">Use letters, numbers, hyphens, or underscores.</p>
           </div>
           <div>
            <label class="block text-sm font-medium text-gray-300 mb-2" for="target-label">Label (optional)</label>
            <input id="target-label" placeholder="Payments Service" class="w-full px-4 py-2 bg-black/30 border border-red-soft/50 rounded-lg text-white focus:outline-none focus:border-red-primary transition-colors">
           </div>
           <div>
            <label class="block text-sm font-medium text-gray-300 mb-2" for="target-url">HTTPS Target URL</label>
            <input id="target-url" required type="url" placeholder="https://example.com" class="w-full px-4 py-2 bg-black/30 border border-red-soft/50 rounded-lg text-white focus:outline-none focus:border-red-primary transition-colors">
           </div>
           <button type="submit" class="w-full py-2 bg-emerald-500/80 hover:bg-emerald-500 text-white font-medium rounded-lg transition-colors">Register Target</button>
           <p id="gateway-status" class="text-xs text-gray-500"></p>
          </form>
         </div>
         <div class="dashboard-card col-span-7">
          <div class="flex items-center justify-between mb-4">
           <h3 class="text-lg font-semibold text-white">Registered Targets</h3>
           <button id="refresh-targets" class="px-3 py-1.5 text-xs bg-sky-500/30 hover:bg-sky-500/50 text-white rounded-lg transition-colors">Refresh</button>
          </div>
          <div id="gateway-targets-list" class="space-y-3 text-sm text-gray-300"></div>
         </div>
        </div>
      <div id="settings-tab" class="tab-content hidden grid grid-cols-12 gap-5">
       <div class="dashboard-card col-span-12">
        <h3 class="text-lg font-semibold text-white mb-5 flex items-center gap-2">
         <svg class="w-6 h-6 text-red-primary" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg> User Session
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
         <div class="bg-black/20 rounded-lg p-4 border border-red-soft/30">
          <p class="text-xs text-gray-500 mb-2">Email</p>
          <p id="session-email" class="text-white font-medium truncate">Not signed in</p>
         </div>
         <div class="bg-black/20 rounded-lg p-4 border border-red-soft/30">
          <p class="text-xs text-gray-500 mb-2">Password</p>
          <p id="session-password" class="metric-value text-red-primary">—</p>
         </div>
         <div class="bg-black/20 rounded-lg p-4 border border-red-soft/30">
          <p class="text-xs text-gray-500 mb-2">Last Login</p>
          <p id="session-login-time" class="metric-value text-gray-300">—</p>
         </div>
        </div>
       </div>
        <div class="dashboard-card col-span-12">
         <h3 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
          <svg class="w-6 h-6 text-red-primary" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13 16h-1v-4h-1m1-4h.01M12 20a8 8 0 100-16 8 8 0 000 16z" /></svg> Recent Users
         </h3>
         <div id="recent-users-list" class="grid grid-cols-1 md:grid-cols-3 gap-3 text-sm"></div>
        </div>
       <div class="dashboard-card col-span-6">
        <h3 class="text-lg font-semibold text-white mb-5 flex items-center gap-2">
         <svg class="w-6 h-6 text-red-primary" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg> System Configuration</h3>
        <div class="space-y-5">
         <div><label class="block text-sm font-medium text-gray-300 mb-2">Detection Sensitivity</label> <select class="w-full px-4 py-2 bg-black/30 border border-red-soft/50 rounded-lg text-white focus:outline-none focus:border-red-primary transition-colors"> <option>Low</option> <option selected>Medium</option> <option>High</option> <option>Very High</option> </select></div>
         <div><label class="block text-sm font-medium text-gray-300 mb-2">Auto-Mitigation Mode</label>
          <div class="flex items-center gap-3"><input type="checkbox" id="auto-mitigation" checked class="w-5 h-5 rounded"> <label for="auto-mitigation" class="text-sm text-gray-400">Enable automatic attack mitigation</label></div>
         </div>
         <div><label class="block text-sm font-medium text-gray-300 mb-2">Rate Limiting Threshold (rps)</label> <input type="number" value="200" class="w-full px-4 py-2 bg-black/30 border border-red-soft/50 rounded-lg text-white focus:outline-none focus:border-red-primary transition-colors"></div>
         <div><label class="block text-sm font-medium text-gray-300 mb-2">Anomaly Score Threshold</label> <input type="number" value="45" min="0" max="100" class="w-full px-4 py-2 bg-black/30 border border-red-soft/50 rounded-lg text-white focus:outline-none focus:border-red-primary transition-colors"></div>
         <div><label class="block text-sm font-medium text-gray-300 mb-2">Alert Notification Channels</label>
          <div class="space-y-2">
           <div class="flex items-center gap-2"><input type="checkbox" id="email-alert" checked> <label for="email-alert" class="text-sm text-gray-400">Email Notifications</label></div>
           <div class="flex items-center gap-2"><input type="checkbox" id="slack-alert" checked> <label for="slack-alert" class="text-sm text-gray-400">Slack Integration</label></div>
           <div class="flex items-center gap-2"><input type="checkbox" id="pagerduty-alert"> <label for="pagerduty-alert" class="text-sm text-gray-400">PagerDuty Incidents</label></div>
          </div>
         </div><button class="w-full py-2 bg-indigo-500/80 hover:bg-indigo-500 text-white font-medium rounded-lg transition-colors">Save Settings</button>
        </div>
       </div>
       <div class="dashboard-card col-span-6">
        <h3 class="text-lg font-semibold text-white mb-5 flex items-center gap-2">
         <svg class="w-6 h-6 text-red-primary" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12l2 2 4-4m7 0a9 9 0 11-18 0 9 9 0 0118 0z" /></svg> System Health &amp; Monitoring</h3>
        <div class="space-y-4">
         <div class="bg-black/20 rounded-lg p-4 border border-red-soft/30">
          <div class="flex items-center justify-between mb-2"><span class="text-sm text-gray-400">Engine Status</span> <span id="engine-status" class="flex items-center gap-1.5 text-emerald-400 font-medium">
            <div class="w-2 h-2 rounded-full bg-emerald-400"></div> Operational </span></div>
          <p class="text-xs text-gray-500">All detection engines running normally</p>
         </div>
         <div class="bg-black/20 rounded-lg p-4 border border-red-soft/30">
          <div class="flex items-center justify-between mb-2"><span class="text-sm text-gray-400">Model Version</span> <span id="model-version" class="metric-value text-red-primary font-medium">v0.2.0</span></div>
          <p id="system-uptime" class="text-xs text-gray-500">Uptime: 0s</p>
         </div>
         <div class="bg-black/20 rounded-lg p-4 border border-red-soft/30">
          <div class="flex items-center justify-between mb-2"><span class="text-sm text-gray-400">System Load</span> <span id="system-load-value" class="text-white font-medium">0%</span></div>
          <div class="h-2 bg-gray-800 rounded-full overflow-hidden">
           <div id="system-load-bar" class="h-full bg-gradient-to-r from-red-primary to-red-accent rounded-full" style="width: 0%"></div>
          </div>
         </div>
         <div class="bg-black/20 rounded-lg p-4 border border-red-soft/30">
          <div class="flex items-center justify-between mb-2"><span class="text-sm text-gray-400">Memory Usage</span> <span id="memory-usage-value" class="text-white font-medium">0%</span></div>
          <div class="h-2 bg-gray-800 rounded-full overflow-hidden">
           <div id="memory-usage-bar" class="h-full bg-gradient-to-r from-red-light to-red-accent rounded-full" style="width: 0%"></div>
          </div>
         </div>
         <div class="bg-black/20 rounded-lg p-4 border border-red-soft/30">
          <div class="flex items-center justify-between mb-2"><span class="text-sm text-gray-400">Detection Accuracy</span> <span id="detection-accuracy-value" class="text-emerald-400 font-medium">0%</span></div>
          <div class="h-2 bg-gray-800 rounded-full overflow-hidden">
           <div id="detection-accuracy-bar" class="h-full bg-gradient-to-r from-emerald-500 to-emerald-400 rounded-full" style="width: 0%"></div>
          </div>
         </div><button id="export-system" class="w-full py-2 bg-slate-700/70 hover:bg-slate-700 text-white font-medium rounded-lg transition-colors">Generate System Report</button>
        </div>
       </div>
      </div>
      <footer class="mt-6 pt-5 border-t border-red-soft/30">
       <div class="flex items-center justify-between text-xs text-gray-500">
        <div class="flex items-center gap-4"><span id="footer-team">Network Security Research Team</span> <span class="text-gray-700">|</span> <span>Prasanth, Abarnesh, Yuvaraja</span></div>
        <div class="flex items-center gap-4"><span id="footer-disclaimer">Academic Research Project - Demonstration Only</span> <span class="text-gray-700">|</span> <span>2026</span></div>
       </div>
      </footer>
     </div>
    </main>
   </div>
  </div>
  <script>
    const defaultConfig = {
      product_name: 'CYNEX – Adaptive Application-Layer DDoS Protection Gateway',
      environment_label: 'Monitoring Mode',
      team_name: 'Network Security Research Team',
      disclaimer_text: 'Academic Research Project - Demonstration Only',
      background_color: '#0f172a',
      surface_color: '#1e293b',
      text_color: '#e2e8f0',
      primary_action_color: '#0891b2',
      accent_color: '#22d3ee'
    };

    let config = { ...defaultConfig };

    const sidebar = document.getElementById('sidebar');
    const toggleBtn = document.getElementById('toggle-sidebar');

    toggleBtn.addEventListener('click', () => {
      sidebar.classList.toggle('-translate-x-full');
      sidebar.classList.toggle('fixed');
      sidebar.classList.toggle('left-0');
      sidebar.classList.toggle('top-0');
      sidebar.classList.toggle('h-screen');
      sidebar.classList.toggle('z-50');
    });

    document.querySelectorAll('.tab-nav').forEach(button => {
      button.addEventListener('click', () => {
        if (window.innerWidth < 1024) {
          sidebar.classList.add('-translate-x-full');
          sidebar.classList.remove('fixed', 'left-0', 'top-0', 'h-screen', 'z-50');
        }
      });
    });

    function updateClock() {
      const now = new Date();
      const timeString = now.toTimeString().split(' ')[0];
      const clockElement = document.getElementById('clock');
      if (clockElement) {
        clockElement.textContent = timeString;
      }
    }
    setInterval(updateClock, 1000);
    updateClock();

    function formatRps(value) {
      if (value >= 1e6) return (value / 1e6).toFixed(2) + 'M';
      if (value >= 1e3) return (value / 1e3).toFixed(1) + 'K';
      return value.toFixed(0);
    }

    function generateChartPath(data, width, height) {
      if (!data || data.length === 0) {
        return { line: `M0,${height} L${width},${height}`, area: `M0,${height} L${width},${height} Z` };
      }
      const maxValue = Math.max(...data, 1);
      const normalized = data.map((value) => height - (value / maxValue) * (height - 20) - 10);
      const stepX = width / (normalized.length - 1);
      let linePath = `M0,${normalized[0]}`;
      let areaPath = `M0,${height} L0,${normalized[0]}`;

      for (let i = 1; i < normalized.length; i++) {
        linePath += ` L${i * stepX},${normalized[i]}`;
        areaPath += ` L${i * stepX},${normalized[i]}`;
      }
      areaPath += ` L${width},${height} Z`;

      return { line: linePath, area: areaPath };
    }

    function applyTrafficMetrics(metrics) {
      if (!metrics) return;
      const rpsValue = metrics.rps || 0;
      const bandwidthValue = metrics.bandwidthGbps || 0;
      const packetsEl = document.getElementById('packets-per-sec');
      const bandwidthEl = document.getElementById('bandwidth');
      const cleanEl = document.getElementById('clean-traffic');
      const blockedEl = document.getElementById('blocked-traffic');

      if (packetsEl) packetsEl.textContent = formatRps(rpsValue);
      if (bandwidthEl) bandwidthEl.textContent = bandwidthValue.toFixed(2);
      if (cleanEl) cleanEl.textContent = `${metrics.cleanPercent.toFixed(1)}%`;
      if (blockedEl) blockedEl.textContent = `${metrics.rateLimitedPercent.toFixed(1)}%`;

      const trafficPath = generateChartPath(metrics.history.rps || [], 800, 200);
      const trafficLine = document.getElementById('traffic-line');
      const trafficArea = document.getElementById('traffic-area');
      if (trafficLine) trafficLine.setAttribute('d', trafficPath.line);
      if (trafficArea) trafficArea.setAttribute('d', trafficPath.area);

      const gradient = document.getElementById('incomingGrad');
      const gradientStops = gradient ? gradient.querySelectorAll('stop') : [];
      let spikeColor = '#22d3ee';
      let spikeOpacity = 0.3;
      if (rpsValue > 40) {
        spikeColor = '#ef4444';
        spikeOpacity = 0.35;
      } else if (rpsValue > 20) {
        spikeColor = '#f59e0b';
        spikeOpacity = 0.32;
      }

      if (trafficLine) trafficLine.setAttribute('stroke', spikeColor);
      if (gradientStops.length >= 2) {
        gradientStops[0].setAttribute('style', `stop-color:${spikeColor};stop-opacity:${spikeOpacity}`);
        gradientStops[1].setAttribute('style', `stop-color:${spikeColor};stop-opacity:0`);
      }

      const cleanPath = generateChartPath(metrics.history.rps.map((value) => value * 0.85), 800, 200);
      const cleanLine = document.getElementById('clean-line');
      if (cleanLine) cleanLine.setAttribute('d', cleanPath.line);

      const ppsPath = generateChartPath(metrics.history.rps || [], 600, 200);
      const ppsLine = document.getElementById('pps-line');
      const ppsArea = document.getElementById('pps-area');
      if (ppsLine) ppsLine.setAttribute('d', ppsPath.line);
      if (ppsArea) ppsArea.setAttribute('d', ppsPath.area);

      const bwPath = generateChartPath(metrics.history.bandwidth || [], 600, 200);
      const bwLine = document.getElementById('bw-line');
      const bwArea = document.getElementById('bw-area');
      if (bwLine) bwLine.setAttribute('d', bwPath.line);
      if (bwArea) bwArea.setAttribute('d', bwPath.area);

      const rpsHistory = metrics.history.rps || [];
      const bwHistory = metrics.history.bandwidth || [];
      if (rpsHistory.length > 0) {
        const peak = Math.max(...rpsHistory);
        const avg = rpsHistory.reduce((a, b) => a + b, 0) / rpsHistory.length;
        const current = rpsHistory[rpsHistory.length - 1];
        document.getElementById('pps-peak').textContent = `Peak: ${formatRps(peak)} rps`;
        document.getElementById('pps-avg').textContent = `Avg: ${formatRps(avg)} rps`;
        document.getElementById('pps-current').textContent = `Current: ${formatRps(current)} rps`;
      }

      if (bwHistory.length > 0) {
        const peak = Math.max(...bwHistory);
        const avg = bwHistory.reduce((a, b) => a + b, 0) / bwHistory.length;
        const current = bwHistory[bwHistory.length - 1];
        document.getElementById('bw-peak').textContent = `Peak: ${peak.toFixed(2)} Gbps`;
        document.getElementById('bw-avg').textContent = `Avg: ${avg.toFixed(2)} Gbps`;
        document.getElementById('bw-current').textContent = `Current: ${current.toFixed(2)} Gbps`;
      }

      const protocol = metrics.protocolDistribution || { http1: 0, http2: 0, websocket: 0 };
      const protoHttp1 = document.getElementById('proto-http1-value');
      const protoHttp2 = document.getElementById('proto-http2-value');
      const protoWs = document.getElementById('proto-ws-value');
      const protoHttp1Bar = document.getElementById('proto-http1-bar');
      const protoHttp2Bar = document.getElementById('proto-http2-bar');
      const protoWsBar = document.getElementById('proto-ws-bar');

      if (protoHttp1) protoHttp1.textContent = `${protocol.http1.toFixed(1)}%`;
      if (protoHttp2) protoHttp2.textContent = `${protocol.http2.toFixed(1)}%`;
      if (protoWs) protoWs.textContent = `${protocol.websocket.toFixed(1)}%`;
      if (protoHttp1Bar) protoHttp1Bar.style.width = `${protocol.http1.toFixed(1)}%`;
      if (protoHttp2Bar) protoHttp2Bar.style.width = `${protocol.http2.toFixed(1)}%`;
      if (protoWsBar) protoWsBar.style.width = `${protocol.websocket.toFixed(1)}%`;
    }

    function updateGauge(score) {
      const gaugeRing = document.getElementById('gauge-ring');
      const scoreEl = document.getElementById('anomaly-score');
      if (scoreEl) scoreEl.textContent = `${Math.round(score)}%`;
      if (gaugeRing) {
        const dashOffset = 283 - (score / 100 * 283);
        gaugeRing.style.strokeDashoffset = dashOffset;
        if (score > 70) {
          gaugeRing.style.stroke = '#ef4444';
        } else if (score > 45) {
          gaugeRing.style.stroke = '#f59e0b';
        } else {
          gaugeRing.style.stroke = '#22d3ee';
        }
      }
    }

    function applyAnomaly(metrics) {
      if (!metrics) return;
      updateGauge(metrics.anomalyScore || 0);
      const confidenceEl = document.getElementById('attack-confidence');
      const detectionEl = document.getElementById('detection-state');
      if (confidenceEl) confidenceEl.textContent = `${(metrics.confidence * 100).toFixed(1)}%`;
      if (detectionEl) {
        const score = metrics.anomalyScore || 0;
        detectionEl.textContent = score >= 70 ? 'Under Attack' : (metrics.trafficClass || 'Monitoring');
      }
    }

    function severityClass(action) {
      if (action === 'rateLimited') return 'critical';
      if (action === 'challenged') return 'warning';
      if (action === 'throttled') return 'warning';
      return 'info';
    }

    function applyMitigation(metrics) {
      if (!metrics) return;
      const list = document.getElementById('mitigation-actions');
      const alertsList = document.getElementById('alerts-list');
      const timeline = document.getElementById('alerts-timeline');
      const featureContainer = document.getElementById('feature-importance');
      const explainText = document.getElementById('explainability-text');

      const items = (metrics.mitigationLog || []).slice(0, 6);

      if (list) {
        list.innerHTML = items.map((item) => {
          const actionColor = item.action === 'allowed' ? 'emerald' : (item.action === 'throttled' || item.action === 'challenged') ? 'amber' : 'red';
          return `
            <div class="flex items-center gap-3 p-2.5 bg-${actionColor}-500/10 border border-${actionColor}-500/30 rounded-lg">
              <div class="w-2 h-2 rounded-full bg-${actionColor}-400"></div>
              <div class="flex-1 min-w-0">
                <p class="text-sm text-${actionColor}-300 font-medium">${item.action.toUpperCase()}</p>
                <p class="text-xs text-slate-500 truncate">${item.reason}</p>
              </div>
              <span class="mono text-xs text-slate-500">${new Date(item.time).toLocaleTimeString()}</span>
            </div>
          `;
        }).join('');
      }

      if (alertsList) {
        alertsList.innerHTML = items.map((item) => {
          const level = severityClass(item.action);
          const colorMap = {
            critical: { bg: 'bg-red-500/10', border: 'border-red-500/30', dot: 'bg-red-400', text: 'text-red-300' },
            warning: { bg: 'bg-amber-500/10', border: 'border-amber-500/30', dot: 'bg-amber-400', text: 'text-amber-300' },
            info: { bg: 'bg-cyan-500/10', border: 'border-cyan-500/30', dot: 'bg-cyan-400', text: 'text-cyan-300' }
          };
          const colors = colorMap[level];
          return `
            <div class="flex items-start gap-3 p-3 ${colors.bg} border ${colors.border} rounded-lg">
              <div class="w-1.5 h-1.5 rounded-full ${colors.dot} mt-1.5 flex-shrink-0"></div>
              <div class="flex-1 min-w-0">
                <div class="flex items-center justify-between">
                  <span class="text-sm font-medium ${colors.text}">${item.action.toUpperCase()}</span>
                  <span class="mono text-xs text-slate-500">${new Date(item.time).toLocaleTimeString()}</span>
                </div>
                <p class="text-xs text-slate-500 mt-0.5">${item.reason}</p>
              </div>
            </div>
          `;
        }).join('');
      }

      if (timeline) {
        timeline.innerHTML = (metrics.mitigationLog || []).map((item) => {
          const level = severityClass(item.action);
          const colorMap = {
            critical: { bg: 'bg-red-500/10', border: 'border-red-500/30', dot: 'bg-red-400', text: 'text-red-300' },
            warning: { bg: 'bg-amber-500/10', border: 'border-amber-500/30', dot: 'bg-amber-400', text: 'text-amber-300' },
            info: { bg: 'bg-cyan-500/10', border: 'border-cyan-500/30', dot: 'bg-cyan-400', text: 'text-cyan-300' }
          };
          const colors = colorMap[level];
          return `
            <div class="flex items-start gap-3 p-3 ${colors.bg} border ${colors.border} rounded-lg">
              <div class="w-1.5 h-1.5 rounded-full ${colors.dot} mt-1.5 flex-shrink-0"></div>
              <div class="flex-1 min-w-0">
                <div class="flex items-center justify-between">
                  <span class="text-sm font-medium ${colors.text}">${item.action.toUpperCase()}</span>
                  <span class="mono text-xs text-slate-500">${new Date(item.time).toLocaleTimeString()}</span>
                </div>
                <p class="text-xs text-slate-500 mt-0.5">${item.reason}</p>
              </div>
            </div>
          `;
        }).join('');
      }

      if (featureContainer && metrics.lastDecision) {
        const features = metrics.lastDecision.topFeatures || [];
        featureContainer.innerHTML = features.map((feature) => {
          return `
            <div>
              <div class="flex items-center justify-between mb-1"><span class="text-xs text-slate-400">${feature}</span> <span class="mono text-xs text-cyan-400">high</span></div>
              <div class="h-1.5 bg-slate-700 rounded-full overflow-hidden">
                <div class="h-full bg-cyan-500 rounded-full" style="width: 80%"></div>
              </div>
            </div>
          `;
        }).join('');
      }

      if (explainText && metrics.lastDecision) {
        explainText.textContent = metrics.lastDecision.reason || 'Awaiting telemetry.';
      }

      const counts = metrics.mitigationLog.reduce((acc, item) => {
        const level = severityClass(item.action);
        acc[level] = (acc[level] || 0) + 1;
        return acc;
      }, { critical: 0, warning: 0, info: 0 });

      document.getElementById('critical-count').textContent = counts.critical;
      document.getElementById('warning-count').textContent = counts.warning;
      document.getElementById('info-count').textContent = counts.info;
    }

    function applyBotHuman(traffic, mitigation) {
      if (!traffic || !mitigation) return;
      const classCounts = mitigation.recentClassCounts || mitigation.trafficClasses || {};
      const botCount = (classCounts.bot || 0) + (classCounts.flood || 0);
      const humanCount = (classCounts.legit || 0) + (classCounts.flash_crowd || 0);
      const totalClassed = botCount + humanCount;
      let botPercent = 0;
      let humanPercent = 0;
      if (totalClassed > 0) {
        botPercent = (botCount / totalClassed) * 100;
        humanPercent = (humanCount / totalClassed) * 100;
      } else {
        botPercent = (traffic.rateLimitedPercent || 0) + (traffic.blockedPercent || 0);
        botPercent = Math.min(100, Math.max(0, botPercent));
        humanPercent = 100 - botPercent;
      }

      const circumference = 251.3;
      const botArcMini = document.getElementById('bot-arc-mini');
      const humanArcMini = document.getElementById('human-arc-mini');
      const botArcLarge = document.getElementById('bot-arc-large');
      const humanArcLarge = document.getElementById('human-arc-large');
      const botLength = (botPercent / 100) * circumference;
      const humanLength = (humanPercent / 100) * circumference;

      if (botArcMini) botArcMini.setAttribute('stroke-dasharray', `${botLength} ${circumference}`);
      if (humanArcMini) {
        humanArcMini.setAttribute('stroke-dasharray', `${humanLength} ${circumference}`);
        humanArcMini.setAttribute('stroke-dashoffset', `${-botLength}`);
      }
      if (botArcLarge) botArcLarge.setAttribute('stroke-dasharray', `${botLength} ${circumference}`);
      if (humanArcLarge) {
        humanArcLarge.setAttribute('stroke-dasharray', `${humanLength} ${circumference}`);
        humanArcLarge.setAttribute('stroke-dashoffset', `${-botLength}`);
      }

      const totalRequests = traffic.totals?.requests || 0;

      const botPercentMain = document.getElementById('bot-percent-main');
      const humanPercentMain = document.getElementById('human-percent-main');
      const botPercentOverall = document.getElementById('bot-percent-overall');
      const humanPercentOverall = document.getElementById('human-percent-overall');
      const botPercentBarMain = document.getElementById('bot-percent-bar-main');
      const humanPercentBarMain = document.getElementById('human-percent-bar-main');
      const botPercentBarOverall = document.getElementById('bot-percent-bar-overall');
      const humanPercentBarOverall = document.getElementById('human-percent-bar-overall');
      const totalLabel = document.getElementById('bot-human-total');

      if (botPercentMain) botPercentMain.textContent = `${botPercent.toFixed(1)}%`;
      if (humanPercentMain) humanPercentMain.textContent = `${humanPercent.toFixed(1)}%`;
      if (botPercentOverall) botPercentOverall.textContent = `${botPercent.toFixed(1)}%`;
      if (humanPercentOverall) humanPercentOverall.textContent = `${humanPercent.toFixed(1)}%`;
      if (botPercentBarMain) botPercentBarMain.style.width = `${botPercent.toFixed(1)}%`;
      if (humanPercentBarMain) humanPercentBarMain.style.width = `${humanPercent.toFixed(1)}%`;
      if (botPercentBarOverall) botPercentBarOverall.style.width = `${botPercent.toFixed(1)}%`;
      if (humanPercentBarOverall) humanPercentBarOverall.style.width = `${humanPercent.toFixed(1)}%`;
      if (totalLabel) totalLabel.textContent = formatRps(totalRequests);

      const botTotalEl = document.getElementById('bot-total-requests');
      const botUniqueEl = document.getElementById('bot-unique');
      const botBlockedEl = document.getElementById('bot-blocked-percent');
      const botAllowedEl = document.getElementById('bot-allowed-percent');
      const botIntensityEl = document.getElementById('bot-intensity');

      const humanTotalEl = document.getElementById('human-total-requests');
      const humanUniqueEl = document.getElementById('human-unique');
      const humanAllowedEl = document.getElementById('human-allowed-percent');
      const humanBlockedEl = document.getElementById('human-blocked-percent');
      const humanLatencyEl = document.getElementById('human-latency');

      const botMaliciousEl = document.getElementById('bot-malicious');
      const botScrapersEl = document.getElementById('bot-scrapers');
      const botCrawlersEl = document.getElementById('bot-crawlers');
      const botLegitEl = document.getElementById('bot-legit');

      if (botTotalEl) botTotalEl.textContent = formatRps(botCount);
      if (botUniqueEl) botUniqueEl.textContent = botCount.toLocaleString();
      const botActions = mitigation.recentClassActions?.bot || mitigation.classActions?.bot || { allowed: 0, throttled: 0, rateLimited: 0, blocked: 0 };
      const humanActions = mitigation.recentClassActions?.human || mitigation.classActions?.human || { allowed: 0, throttled: 0, rateLimited: 0, blocked: 0 };
      const botTotalActions = botActions.allowed + botActions.throttled + botActions.rateLimited + botActions.blocked || 1;
      const humanTotalActions = humanActions.allowed + humanActions.throttled + humanActions.rateLimited + humanActions.blocked || 1;
      const botAllowedPercent = (botActions.allowed / botTotalActions) * 100;
      const botBlockedPercent = ((botActions.throttled + botActions.rateLimited + botActions.blocked) / botTotalActions) * 100;
      const humanAllowedPercent = (humanActions.allowed / humanTotalActions) * 100;
      const humanBlockedPercent = ((humanActions.throttled + humanActions.rateLimited + humanActions.blocked) / humanTotalActions) * 100;

      if (botBlockedEl) botBlockedEl.textContent = `${botBlockedPercent.toFixed(1)}%`;
      if (botAllowedEl) botAllowedEl.textContent = `${botAllowedPercent.toFixed(1)}%`;
      if (botIntensityEl) botIntensityEl.textContent = botPercent > 60 ? 'High' : botPercent > 30 ? 'Medium' : 'Low';

      if (humanTotalEl) humanTotalEl.textContent = formatRps(humanCount);
      if (humanUniqueEl) humanUniqueEl.textContent = humanCount.toLocaleString();
      if (humanAllowedEl) humanAllowedEl.textContent = `${humanAllowedPercent.toFixed(1)}%`;
      if (humanBlockedEl) humanBlockedEl.textContent = `${humanBlockedPercent.toFixed(1)}%`;
      if (humanLatencyEl) humanLatencyEl.textContent = `${(traffic.avgLatencyMs || 0).toFixed(0)}ms`;

      if (botMaliciousEl) botMaliciousEl.textContent = (classCounts.flood || 0).toLocaleString();
      if (botScrapersEl) botScrapersEl.textContent = (classCounts.bot || 0).toLocaleString();
      if (botCrawlersEl) botCrawlersEl.textContent = (classCounts.flash_crowd || 0).toLocaleString();
      if (botLegitEl) botLegitEl.textContent = (classCounts.legit || 0).toLocaleString();
    }

    function applySystemMetrics(system, traffic) {
      if (!system) return;
      const systemLoadEl = document.getElementById('system-load-value');
      const systemLoadBar = document.getElementById('system-load-bar');
      const memoryValueEl = document.getElementById('memory-usage-value');
      const memoryBar = document.getElementById('memory-usage-bar');
      const detectionValueEl = document.getElementById('detection-accuracy-value');
      const detectionBar = document.getElementById('detection-accuracy-bar');
      const uptimeEl = document.getElementById('system-uptime');
      const modelVersionEl = document.getElementById('model-version');

      const cpu = system.cpuPercent || 0;
      const mem = system.memory?.systemUsedPercent || 0;
      const success = traffic?.statusCodes?.success || 0;
      const totalStatus = success + (traffic?.statusCodes?.clientError || 0) + (traffic?.statusCodes?.serverError || 0) || 1;
      const accuracy = (success / totalStatus) * 100;

      if (systemLoadEl) systemLoadEl.textContent = `${cpu.toFixed(1)}%`;
      if (systemLoadBar) systemLoadBar.style.width = `${cpu.toFixed(1)}%`;
      if (memoryValueEl) memoryValueEl.textContent = `${mem.toFixed(1)}%`;
      if (memoryBar) memoryBar.style.width = `${mem.toFixed(1)}%`;
      if (detectionValueEl) detectionValueEl.textContent = `${accuracy.toFixed(1)}%`;
      if (detectionBar) detectionBar.style.width = `${accuracy.toFixed(1)}%`;
      if (uptimeEl) uptimeEl.textContent = `Uptime: ${Math.floor(system.uptimeSeconds || 0)}s`;
      if (modelVersionEl && system.nodeVersion) modelVersionEl.textContent = system.nodeVersion;
    }

    function applyGatewayState(state) {
      if (!state) return;
      const envLabel = document.getElementById('dashboard-environment');
      if (envLabel) {
        const modeLabel = state.mode === 'active-mitigation'
          ? 'Active Mitigation'
          : state.mode === 'learning'
            ? 'Learning'
            : 'Standby';
        envLabel.textContent = modeLabel;
      }

      const statusEl = document.getElementById('system-status');
      if (statusEl) {
        const modeClass = state.mode === 'active-mitigation'
          ? ['bg-red-500/10', 'border-red-500/30', 'text-red-400']
          : state.mode === 'learning'
            ? ['bg-amber-500/10', 'border-amber-500/30', 'text-amber-400']
            : ['bg-emerald-500/10', 'border-emerald-500/30', 'text-emerald-400'];
        statusEl.className = `flex items-center gap-3 px-4 py-2 rounded-lg ${modeClass[0]} ${modeClass[1]} status-normal`;
        statusEl.querySelector('span').textContent = state.mode === 'active-mitigation'
          ? 'Mitigation Active'
          : state.mode === 'learning'
            ? 'Learning Mode'
            : 'Standby';
      }
    }

    async function fetchMetrics() {
      try {
        const [trafficRes, anomalyRes, mitigationRes, explainRes, gatewayRes, systemRes] = await Promise.all([
          fetch('/metrics/traffic'),
          fetch('/metrics/anomaly'),
          fetch('/metrics/mitigation'),
          fetch('/metrics/explainability'),
          fetch('/gateway/state'),
          fetch('/metrics/system')
        ]);
        const traffic = await trafficRes.json();
        const anomaly = await anomalyRes.json();
        const mitigation = await mitigationRes.json();
        const explainability = await explainRes.json();
        const gatewayState = await gatewayRes.json();
        const system = await systemRes.json();
        applyTrafficMetrics(traffic);
        applyAnomaly(anomaly);
        applyMitigation(mitigation);
        applyGatewayState(gatewayState);
        applyBotHuman(traffic, mitigation);
        applySystemMetrics(system, traffic);
        if (explainability?.reason) {
          const explainText = document.getElementById('explainability-text');
          if (explainText) {
            const trustPercent = (explainability.trustScore * 100).toFixed(0);
            const confidencePercent = (explainability.confidence * 100).toFixed(0);
            explainText.textContent = `${explainability.reason} Trust: ${trustPercent}%. Confidence: ${confidencePercent}%.`;
          }
        }
      } catch (error) {
        console.warn('Metrics fetch failed', error);
      }
    }

    function renderTargets(targets) {
      const list = document.getElementById('gateway-targets-list');
      if (!list) return;
      if (!targets || targets.length === 0) {
        list.innerHTML = '<div class="text-slate-500 text-sm">No targets registered.</div>';
        return;
      }
      list.innerHTML = targets.map((target) => {
        const createdAt = new Date(target.createdAt || Date.now()).toLocaleString();
        return `
          <div class="p-4 bg-slate-900/50 rounded-lg border border-slate-700/30">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-white font-medium">${target.label || target.id}</p>
                <p class="text-xs text-slate-500 mono">${target.id}</p>
              </div>
              <span class="text-xs text-slate-500">${createdAt}</span>
            </div>
            <p class="text-xs text-cyan-400 mt-2 mono break-all">${target.url}</p>
            <p class="text-xs text-slate-500 mt-2">Gateway path: /gateway/${target.id}/</p>
          </div>
        `;
      }).join('');
    }

    async function fetchTargets() {
      try {
        const response = await fetch('/api/targets');
        const payload = await response.json();
        renderTargets(payload.targets || []);
      } catch (error) {
        console.warn('Target list fetch failed', error);
      }
    }

    function setupGatewayForm() {
      const form = document.getElementById('gateway-target-form');
      const statusEl = document.getElementById('gateway-status');
      const refreshBtn = document.getElementById('refresh-targets');
      if (refreshBtn) {
        refreshBtn.addEventListener('click', () => fetchTargets());
      }
      if (!form) return;
      form.addEventListener('submit', async (event) => {
        event.preventDefault();
        const targetId = document.getElementById('target-id')?.value?.trim();
        const label = document.getElementById('target-label')?.value?.trim();
        const url = document.getElementById('target-url')?.value?.trim();
        if (!targetId || !url) {
          if (statusEl) statusEl.textContent = 'Target ID and HTTPS URL are required.';
          return;
        }
        if (statusEl) statusEl.textContent = 'Registering target...';
        try {
          const response = await fetch('/api/register-target', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ targetId, label, url })
          });
          const payload = await response.json();
          if (!response.ok) {
            if (statusEl) statusEl.textContent = payload.error || 'Registration failed.';
            return;
          }
          if (statusEl) statusEl.textContent = `Registered ${payload.target?.id || targetId}.`;
          form.reset();
          fetchTargets();
        } catch (error) {
          if (statusEl) statusEl.textContent = 'Registration failed.';
        }
      });
    }

    function connectWebSocket() {
      try {
        const socket = new WebSocket(`${window.location.origin.replace('http', 'ws')}/ws/metrics`);
        socket.addEventListener('message', (event) => {
          const payload = JSON.parse(event.data);
          if (payload.traffic) applyTrafficMetrics(payload.traffic);
          if (payload.mitigation) {
            applyMitigation(payload.mitigation);
            applyAnomaly({
              anomalyScore: payload.mitigation.lastDecision?.anomalyScore || 0,
              trafficClass: payload.mitigation.lastDecision?.trafficClass || 'Monitoring',
              confidence: payload.mitigation.lastDecision?.confidence || 0
            });
            applyBotHuman(payload.traffic, payload.mitigation);
          }
        });
        socket.addEventListener('close', () => {
          setTimeout(connectWebSocket, 3000);
        });
      } catch (error) {
        console.warn('WebSocket unavailable, falling back to polling.');
      }
    }

    setInterval(fetchMetrics, 3000);
    fetchMetrics();
    connectWebSocket();
    setupGatewayForm();
    fetchTargets();

    document.querySelectorAll('.tab-nav').forEach(button => {
      button.addEventListener('click', function(e) {
        e.preventDefault();
        const tabName = this.getAttribute('data-tab');
        document.querySelectorAll('.tab-content').forEach(tab => {
          tab.classList.add('hidden');
        });
        document.querySelectorAll('.tab-nav').forEach(btn => {
          btn.classList.remove('active', 'bg-cyan-500/10', 'text-cyan-400', 'border-cyan-500/20');
          btn.classList.add('text-slate-400', 'hover:text-white', 'hover:bg-slate-800/50');
        });
        const selectedTab = document.getElementById(tabName + '-tab');
        if (selectedTab) {
          selectedTab.classList.remove('hidden');
        }
        this.classList.add('active', 'bg-cyan-500/10', 'text-cyan-400', 'border-cyan-500/20');
        this.classList.remove('text-slate-400', 'hover:text-white', 'hover:bg-slate-800/50');
      });
    });

    const SESSION_KEY = 'dashboardUser';
    const RECENT_USERS_KEY = 'dashboardRecentUsers';
    const loginPage = document.getElementById('login-page');
    const dashboardPage = document.getElementById('dashboard-page');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const loginError = document.getElementById('login-error');

    const userInitials = document.getElementById('user-initials');
    const userDisplayName = document.getElementById('user-display-name');
    const userRole = document.getElementById('user-role');
    const sessionEmail = document.getElementById('session-email');
    const sessionPassword = document.getElementById('session-password');
    const sessionLoginTime = document.getElementById('session-login-time');
    const recentUsersList = document.getElementById('recent-users-list');

    const defaultUserView = {
      initials: 'SA',
      displayName: 'SOC Analyst',
      role: 'Level 2',
      email: 'Not signed in',
      passwordMask: '—',
      loginAt: '—'
    };

    function deriveInitials(email) {
      if (!email) return defaultUserView.initials;
      const local = email.split('@')[0] || '';
      const parts = local.split(/[._-]+/).filter(Boolean);
      if (parts.length === 0) return defaultUserView.initials;
      const first = parts[0][0] || '';
      const second = parts.length > 1 ? (parts[1][0] || '') : (parts[0][1] || '');
      return (first + second).toUpperCase();
    }

    function deriveDisplayName(email) {
      if (!email) return defaultUserView.displayName;
      const local = email.split('@')[0] || '';
      return local
        .split(/[._-]+/)
        .filter(Boolean)
        .map((part) => part.charAt(0).toUpperCase() + part.slice(1))
        .join(' ');
    }

    function maskPassword(value) {
      if (!value) return defaultUserView.passwordMask;
      const length = Math.min(value.length, 16);
      return '•'.repeat(Math.max(length, 6));
    }

    function applyUserToDashboard(user) {
      const view = user || defaultUserView;
      if (userInitials) userInitials.textContent = view.initials || defaultUserView.initials;
      if (userDisplayName) userDisplayName.textContent = view.displayName || defaultUserView.displayName;
      if (userRole) userRole.textContent = view.role || defaultUserView.role;
      if (sessionEmail) sessionEmail.textContent = view.email || defaultUserView.email;
      if (sessionPassword) sessionPassword.textContent = view.passwordMask || defaultUserView.passwordMask;
      if (sessionLoginTime) sessionLoginTime.textContent = view.loginAt || defaultUserView.loginAt;
    }

    function loadRecentUsers() {
      try {
        const stored = localStorage.getItem(RECENT_USERS_KEY);
        if (!stored) return [];
        const parsed = JSON.parse(stored);
        return Array.isArray(parsed) ? parsed : [];
      } catch (error) {
        return [];
      }
    }

    function saveRecentUser(user) {
      if (!user?.email) return;
      const existing = loadRecentUsers();
      const filtered = existing.filter((entry) => entry.email !== user.email);
      const next = [
        {
          email: user.email,
          displayName: user.displayName,
          initials: user.initials,
          lastLoginAt: user.loginAt
        },
        ...filtered
      ].slice(0, 6);
      localStorage.setItem(RECENT_USERS_KEY, JSON.stringify(next));
      renderRecentUsers(next);
    }

    function renderRecentUsers(users) {
      if (!recentUsersList) return;
      if (!users || users.length === 0) {
        recentUsersList.innerHTML = '<div class="text-xs text-gray-500">No previous users yet.</div>';
        return;
      }
      recentUsersList.innerHTML = users.map((entry) => {
        return `
          <div class="flex items-center gap-3 bg-black/20 rounded-lg p-3 border border-red-soft/30">
            <div class="w-8 h-8 rounded-full bg-gradient-to-br from-red-primary to-red-accent flex items-center justify-center text-xs font-semibold text-white">
              ${entry.initials || 'NA'}
            </div>
            <div class="min-w-0">
              <p class="text-sm text-white font-medium truncate">${entry.displayName || 'Unknown'}</p>
              <p class="text-xs text-gray-500 truncate">${entry.email || ''}</p>
            </div>
            <div class="ml-auto text-xs text-gray-500">${entry.lastLoginAt || ''}</div>
          </div>
        `;
      }).join('');
    }

    function showDashboard() {
      loginPage.classList.add('hidden');
      dashboardPage.classList.remove('hidden');
    }

    function showLogin() {
      dashboardPage.classList.add('hidden');
      loginPage.classList.remove('hidden');
    }

    function loadSession() {
      try {
        const stored = localStorage.getItem(SESSION_KEY);
        if (!stored) {
          applyUserToDashboard(null);
          renderRecentUsers(loadRecentUsers());
          return false;
        }
        const user = JSON.parse(stored);
        applyUserToDashboard(user);
        showDashboard();
        renderRecentUsers(loadRecentUsers());
        return true;
      } catch (error) {
        applyUserToDashboard(null);
        renderRecentUsers(loadRecentUsers());
        return false;
      }
    }

    document.getElementById('login-btn').addEventListener('click', function(e) {
      e.preventDefault();
      const email = (emailInput?.value || '').trim();
      const password = passwordInput?.value || '';
      if (!email || !password) {
        if (loginError) loginError.classList.remove('hidden');
        return;
      }

      if (loginError) loginError.classList.add('hidden');

      const user = {
        email,
        displayName: deriveDisplayName(email),
        initials: deriveInitials(email),
        role: 'Authenticated User',
        passwordMask: maskPassword(password),
        loginAt: new Date().toLocaleString()
      };

      localStorage.setItem(SESSION_KEY, JSON.stringify(user));
      saveRecentUser(user);
      applyUserToDashboard(user);
      showDashboard();
      if (passwordInput) passwordInput.value = '';
    });

    document.getElementById('logout-btn').addEventListener('click', function(e) {
      e.preventDefault();
      localStorage.removeItem(SESSION_KEY);
      applyUserToDashboard(null);
      showLogin();
      renderRecentUsers(loadRecentUsers());
      if (emailInput) emailInput.value = '';
      if (passwordInput) passwordInput.value = '';
      if (loginError) loginError.classList.add('hidden');
    });

    loadSession();

    const exportButton = document.getElementById('export-alerts');
    if (exportButton) {
      exportButton.addEventListener('click', async () => {
        try {
          const response = await fetch('/metrics/mitigation');
          const payload = await response.json();
          const dataStr = JSON.stringify(payload.mitigationLog || [], null, 2);
          const blob = new Blob([dataStr], { type: 'application/json' });
          const url = URL.createObjectURL(blob);
          const link = document.createElement('a');
          link.href = url;
          link.download = `cynex-alerts-${new Date().toISOString()}.json`;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          URL.revokeObjectURL(url);
        } catch (error) {
          console.warn('Export failed', error);
        }
      });
    }

    const telegramButton = document.getElementById('manual-telegram-alert');
    const telegramStatus = document.getElementById('manual-telegram-status');
    if (telegramButton) {
      telegramButton.addEventListener('click', async () => {
        if (telegramStatus) telegramStatus.textContent = 'Sending Telegram alert...';
        try {
          const response = await fetch('/api/alerts/telegram', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              message: 'Manual alert triggered from the CYNEX dashboard.'
            })
          });
          const payload = await response.json();
          if (!response.ok) {
            if (telegramStatus) {
              const detailText = payload.details ? ` (${payload.details})` : '';
              telegramStatus.textContent = `${payload.error || 'Telegram alert failed.'}${detailText}`;
            }
            return;
          }
          if (telegramStatus) telegramStatus.textContent = 'Telegram alert sent.';
        } catch (error) {
          if (telegramStatus) telegramStatus.textContent = 'Telegram alert failed.';
        }
      });
    }

    const systemExportButton = document.getElementById('export-system');
    if (systemExportButton) {
      systemExportButton.addEventListener('click', async () => {
        try {
          const response = await fetch('/metrics/system');
          const payload = await response.json();
          const dataStr = JSON.stringify(payload, null, 2);
          const blob = new Blob([dataStr], { type: 'application/json' });
          const url = URL.createObjectURL(blob);
          const link = document.createElement('a');
          link.href = url;
          link.download = `cynex-system-${new Date().toISOString()}.json`;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          URL.revokeObjectURL(url);
        } catch (error) {
          console.warn('System export failed', error);
        }
      });
    }

    async function onConfigChange(newConfig) {
      config = { ...defaultConfig, ...newConfig };
      const loginProductName = document.getElementById('login-product-name');
      const dashboardProductName = document.getElementById('dashboard-product-name');
      if (loginProductName) loginProductName.textContent = config.product_name || defaultConfig.product_name;
      if (dashboardProductName) dashboardProductName.textContent = config.product_name || defaultConfig.product_name;
      const dashboardEnvironment = document.getElementById('dashboard-environment');
      if (dashboardEnvironment) dashboardEnvironment.textContent = config.environment_label || defaultConfig.environment_label;
      const footerTeam = document.getElementById('footer-team');
      const footerDisclaimer = document.getElementById('footer-disclaimer');
      if (footerTeam) footerTeam.textContent = config.team_name || defaultConfig.team_name;
      if (footerDisclaimer) footerDisclaimer.textContent = config.disclaimer_text || defaultConfig.disclaimer_text;
      document.body.style.setProperty('--bg-color', config.background_color || defaultConfig.background_color);
      document.body.style.setProperty('--surface-color', config.surface_color || defaultConfig.surface_color);
      document.body.style.setProperty('--text-color', config.text_color || defaultConfig.text_color);
      document.body.style.setProperty('--primary-color', config.primary_action_color || defaultConfig.primary_action_color);
      document.body.style.setProperty('--accent-color', config.accent_color || defaultConfig.accent_color);
    }

    function mapToCapabilities(cfg) {
      return {
        recolorables: [
          {
            get: () => cfg.background_color || defaultConfig.background_color,
            set: (value) => { cfg.background_color = value; window.elementSdk.setConfig({ background_color: value }); }
          },
          {
            get: () => cfg.surface_color || defaultConfig.surface_color,
            set: (value) => { cfg.surface_color = value; window.elementSdk.setConfig({ surface_color: value }); }
          },
          {
            get: () => cfg.text_color || defaultConfig.text_color,
            set: (value) => { cfg.text_color = value; window.elementSdk.setConfig({ text_color: value }); }
          },
          {
            get: () => cfg.primary_action_color || defaultConfig.primary_action_color,
            set: (value) => { cfg.primary_action_color = value; window.elementSdk.setConfig({ primary_action_color: value }); }
          },
          {
            get: () => cfg.accent_color || defaultConfig.accent_color,
            set: (value) => { cfg.accent_color = value; window.elementSdk.setConfig({ accent_color: value }); }
          }
        ],
        borderables: [],
        fontEditable: undefined,
        fontSizeable: undefined
      };
    }

    function mapToEditPanelValues(cfg) {
      return new Map([
        ['product_name', cfg.product_name || defaultConfig.product_name],
        ['environment_label', cfg.environment_label || defaultConfig.environment_label],
        ['team_name', cfg.team_name || defaultConfig.team_name],
        ['disclaimer_text', cfg.disclaimer_text || defaultConfig.disclaimer_text]
      ]);
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities,
        mapToEditPanelValues
      });
    }
  </script>
 </body>
</html>
